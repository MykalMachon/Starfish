pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- starfish ★
-- a stardew valley fishing demake.

-- https://mykal.codes/

function _init()
	poke(0x5f2d, 0x1) -- enable mouse

	cartdata("mykalcodes_starfish_1")
	high_score = dget(0)
	debug = true -- global flag
	
	create_player(
		62,
		12,
		24,
		96
	)
end

function _update()
	update_player()
end

function _draw()
	cls()
	draw_player()
	-- map(0,0,0,0)
end
-->8
-- player mgr

-- org_x is the x origin
-- org_y is the y origin
-- length is the player length
-- height is playspace height
function create_player(
	org_x,
	org_y,
	length,
	box_size
)
	p={}
	p.org_x=org_x
	p.org_y=org_y
	p.x=org_x
	p.y=org_y+flr(box_size/2)-- y pos of tail
	p.dy=0 -- dir y speed
	p.my=3 -- max y speed
	p.l=length -- piece length in px
	p.dir="down"
	p.box_size = box_size
	
	p.grav = 0.5
	p.powr = 1
	-- p.fric = 0.5
end

function update_player()
	p.dy+=p.grav
	if(btn(❎) or stat(34)==1) p.dy-=p.powr -- move up
	
	-- downward cases
	if (p.dy > 0) then 
		p.dir="down"
		next_y_pos = (p.y+p.l)+p.dy
		bott_y_pos = (p.org_y+p.box_size)
		
		-- check if at bottom
		if (next_y_pos >= bott_y_pos) p.dy=0 p.y=bott_y_pos-p.l
	end
	
	-- upward case 
	if (p.dy < 0) then
		p.dir="up"
		next_y_pos = p.y + p.dy
		top_y_pos = p.org_y
		
		-- check if at top
		-- todo: cleanup bounc function
		if(next_y_pos<top_y_pos) p.dy=-1*(p.dy*0.5) p.y=top_y_pos
	end
	
	p.y += p.dy

	-- maintain max dy 
	if abs(p.dy - 0.1) >= p.my then 
		if(p.dy > p.my) p.dy=p.my
		if(p.dy < p.my) p.dy=-1*p.my
	end
end

function draw_player()
	if debug then
		print("dy: ".. p.dy, 0, 0)
		print("p: "..p.y, 0, 12)
		print("dir: "..p.dir, 0, 24)
		print("mouse: "..stat(34), 0, 36)
	end
	
	--draw border
	rectfill(
		(p.org_x-1),
		(p.org_y-1),
		(p.org_x+6),
		(p.org_y+1) + p.box_size,
		1
	)
	
	--infill black
	rectfill(
		(p.org_x-1)+1,
		(p.org_y+1)-1,
		(p.org_x+5),
		(p.org_y) + p.box_size,
		0
	)
	
	-- draw "player"
	rectfill(
		p.x,
		p.y,
		p.x+5,
		p.y+(p.l),
		12
	)
end
__gfx__
000000009000000990000009aa9999aa033333300333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009000000990000009a000000a033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000a000000aa000000a90000009033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa0000aaaa0000aa90000009033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000900000099000000990000009033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000900000099000000990000009033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000a000000aa000000aa000000a033333300333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
00000000aa9999aaaa0000aaaa0000aa000000000333333003333330000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
